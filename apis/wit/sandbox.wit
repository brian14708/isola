package promptkit:script;

interface host-api {
    variant argument {
        cbor(list<u8>),
        iterator(argument-iterator),
    }
    resource argument-iterator {
        read: func() -> option<argument>;
    }
    enum log-level {
        debug,
        info,
        warn,
        error,
    }
    emit: func(%cbor: list<u8>);
    emit-log: func(%level: log-level, %log: string);
}

interface guest-api {
    use host-api.{argument, log-level};
    enum error-code {
        unknown,
        internal,
        aborted,
    }
    record error {
        code: error-code,
        message: string,
    }

    set-log-level: func(%level: option<log-level>) -> ();
    eval-bundle: func(%bundle-path: string, entrypoint: string) -> result<_, error>;
    eval-script: func(%script: string) -> result<_, error>;
    call-func: func(%func: string, %args: list<argument>) -> result<option<list<u8>>, error>;
}

world sandbox {
    include wasi:io/imports@0.2.0;
    import promptkit:http/client;

    import llm;
    import host-api;
    export guest-api;
}
